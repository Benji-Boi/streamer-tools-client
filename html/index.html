<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Home - Streamer tools client</title>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link href="standard.css" type="text/css" rel="stylesheet">
    </head>
    <body>
        <div style="display: flex;">
            <div class="sidebar" style="flex: 0;">
                <div class="sidebarItemSelected" href="#" onclick='fetch("http://localhost:53510/windows/home")'>
                    Home
                </div>
                <div class="sidebarItem" onclick='fetch("http://localhost:53510/windows/overlays")'>
                    Overlays
                </div>
                <div class="sidebarItem" onclick='fetch("http://localhost:53510/windows/downloads")'>
                    Downloads
                </div>
            </div>
            <div class="content" style="flex: 1;">
                <div style="text-align: center; font-size: 24px; margin-bottom: 10px;">
                    Streamer Tools Client
                </div>
                <div style="text-align: center; font-size: 18px;">
                    IP <input type='text' id="ip">
                    <br/>

                    <input type='button' value="Save IP" id="saveIp">
                    <br/>
                    <input type='button' value="Download the Quest mod" onclick="window.open('https://github.com/EnderdracheLP/streamer-tools/releases/latest', '_blank')">
                    <div style="font-size: 14px; margin-left: 10px; margin-top: 15px;">
                        If the overlays seem to be frozen then restart both Beat Saber and this Client and make sure you set the right IP address.
                    </div>
                </div>
            </div>
        </div>
        
    </body>
    <script>
        var ipReg = /^((2(5[0-5]|[0-4][0-9])|1?[0-9]?[0-9])\.){3}(2(5[0-5]|[0-4][0-9])|1?[0-9]?[0-9])$/g
        fetch("http://localhost:53510/api/getip").then((res) => {
            res.json().then((json) => {
                console.log(json.ip)
                if(json.ip != null && json.ip != "null") document.getElementById("ip").value = json.ip
            });
        })

        document.getElementById("saveIp").onclick = function() {
            console.log(document.getElementById("ip").value)
            if(!ipReg.test(document.getElementById("ip").value)) {
                alert("IP is not valid")
                return
            }
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost:53510/api/postip", true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({
                "ip": document.getElementById("ip").value
            }));
        }
    </script>
</html>